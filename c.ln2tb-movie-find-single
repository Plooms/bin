#!/bin/bash
# (Add - Move - Delete - Rename - Change - Find) and do lots of shit to the Media Collection


# Source the VAR MOAS
source /usr/local/bin/VAR-SCRIPT

TMP="$(mktemp)"
TMP2="$(mktemp)"
TMP_LOG1="$(mktemp)"


if [ -n "$TERM_LAUNCH" ]
then FILE_NAME="$(xclip -o)"
else
FILE_NAME=$(dialog --extra-button --extra-label "Back" --stdout  --clear --inputbox \
"Please Enter the name of the Show" 10 50 )
fi



case $? in
0)

# To remove whitespaces from the beginning & the end
FILE_NAME="$(echo $FILE_NAME | sed "s/^[ \t]*//;s/[ \t]*$//")"


find "$MOVIE_SYM" -maxdepth 1 -type d -iname "*$FILE_NAME*" \
| sort | while read -r FILE1 ; do basename "$FILE1" ; done > $TMP

while read FILE2 ; do movie_array+=("$FILE2") ; done < $TMP



echo -e "${RED}\n-----------################-------------\n${COLOR_OFF}"



for i in "${movie_array[@]}"
do

#################################
MOVIE_NAME="$(echo $i | sed "s/(//g;s/)//g;s/'/\\\\\\'/g;s/^[ \t]*//;s/[ \t]*$//")"
NAME="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select Name from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
SIZE="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select Size_MB from movies where Name LIKE '%$MOVIE_NAME%'" -ss) MB"
RES1="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select ResWidth from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
RES2="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select ResHeight from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
DEF="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select definition from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
WATCHED="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select Watched from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
NOTES="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select notes from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
#################################

GREEN
echo -en "Name =  ${WHITE}$NAME${COLOR_OFF}"
GREEN
echo -en "Size =  ${WHITE}$SIZE${COLOR_OFF}"
GREEN
echo -en "Resolution = ${WHITE}"$RES1 x $RES2"p ${COLOR_OFF}${PURPLE}  "$DEF" ${COLOR_OFF}"
GREEN
echo -en "Watched = ${WHITE}$WATCHED"
GREEN
echo -en "Notes =  ${CYAN}$NOTES${COLOR_OFF}"
YELLOW



echo -e "${RED}\n-----------################-------------\n${COLOR_OFF}"

done



#---#
echo -e "${YELLOW}\n-----------################-------------${COLOR_OFF}"
#################################
for i in "${movie_array[@]}"
do
MOVIE_NAME="$i"
NAME="$(mysql -uroot -p"$DB_PASSWORD" movie_folders -e "select Movie_Folder from folders where Movie_Folder LIKE '%$MOVIE_NAME%'" -ss)"

#find "$MOVIE_SYM"/ -maxdepth 2 -type d -iname "*$FILE_NAME*" | sort -bf
echo -e "$MOVIE_SYM/${WHITE}$NAME${COLOR_OFF}"

done
#################################
echo -e "${YELLOW}\n-----------################-------------\n\n${COLOR_OFF}"



echo "Log File:   sudo geany $TMP_LOG1"

if [ -n "$TERM_LAUNCH" ]
then sleep 1000
fi
;;
1)
_CANCEL_MSG ;; 

3)
ln2tb ;;

esac
