#!/bin/bash
# (Add - Move - Delete - Rename - Change - Find) and do lots of shit to the Media Collection
SCRIPT_NAME="c.ln2tb-movie-find-batch"
PID=$$


# Source the VAR MOAS
source /usr/local/bin/VAR-SCRIPT

TMP1="$(mktemp)"
TMP2="$(mktemp)"
TMP3="$(mktemp)"
TMP_LOG1="$(mktemp)"

start=$(dialog --stdout  --clear --help-button --help-label "Cancel" --yesno \
"Did you add the Movie names to $BATCH_FILE_MOVIE_FIND ?" 10 50 )

case $? in
0)
if [ -f "$BATCH_FILE_MOVIE_FIND" ]
then

while read FILE_NAME
do
export SCRIPT_LAUNCH="Y" ;/usr/local/bin/c.ln2tb-movie-find-single "$FILE_NAME"
done < "$BATCH_FILE_MOVIE_FIND"


#################################
echo -e "${YELLOW}\n-----------################-------------${COLOR_OFF}\n"

MOVIE_NAME="$(echo $i | sed "s/(//g;s/)//g;s/'/\\\\\\'/g;s/^[ \t]*//;s/[ \t]*$//")"
NAME="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select Name from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
WATCHED="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select Watched from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
if [ "$WATCHED" = "YES" ] ; then WATCHED="${PURPLE}(YES)";else WATCHED="${RED}(NO)";fi
echo -e "${WHITE}$NAME${COLOR_OFF} $WATCHED"


echo -e "${YELLOW}\n-----------################-------------\n\n${COLOR_OFF}"
#################################


#while read FILE_NAME ; do 
#find "$MOVIE_SYM" -maxdepth 2 -type d -iname "*$FILE_NAME*" \
#| sort | while read -r FILE1 ; do basename "$FILE1" ;done
#done < "$BATCH_FILE_MOVIE_FIND" > $TMP1

while read FILE2 ; do movie_array+=("$FILE2") ; done < "$BATCH_FILE_MOVIE_FIND"



#echo -e "${RED}\n-----------################-------------\n${COLOR_OFF}"



for i in "${movie_array[@]}"
do

		
#################################
MOVIE_NAME="$(echo $i | sed "s/(//g;s/)//g;s/'/\\\\\\'/g")"
NAME="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select Name from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
SIZE="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select size_mb from movies where Name LIKE '%$MOVIE_NAME%'" -ss) MB"
RES1="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select ResWidth from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
RES2="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select ResHeight from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
DEF="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select definition from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
WATCHED="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select Watched from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
if [ "$WATCHED" = "YES" ] ; then WATCHED="${PURPLE}(YES)";else WATCHED="${RED}(NO)";fi
NOTES="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select notes from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
DATE="$(mysql -uroot -p"$DB_PASSWORD" movies -e "select Date from movies where Name LIKE '%$MOVIE_NAME%'" -ss)"
#################################

if [ ! -z "$NAME" ]
then

GREEN
echo -e "Name:	 ${WHITE}$NAME${COLOR_OFF}"
GREEN
echo -e "Size:	 ${WHITE}$SIZE${COLOR_OFF}"
GREEN
echo -e "Res:	 ${WHITE}"$RES1 x $RES2"p ${COLOR_OFF}${PURPLE}  "$DEF" ${COLOR_OFF}"
GREEN
echo -e "Added:	 ${WHITE}"$DATE" ${COLOR_OFF}"
GREEN
echo -e "Watched: ${WHITE}$WATCHED"
GREEN
[ -n "$NOTES" ] && echo -e "Notes:	 ${CYAN}$NOTES"
YELLOW


echo -e "${RED}\n-----------################-------------\n${COLOR_OFF}"

fi


####### For the log file#########
if [[ "$WATCHED" = *"YES" ]] ; then WATCHED="(YES)";else WATCHED="(NO)";fi
echo -e "
Path: $i
Name:  $NAME
Size:  $SIZE
Res: $RES1 x "$RES2"p  $DEF
Watched: $WATCHED
-----------################-------------
" >> "$TMP_LOG1"
####### For the log file#########

done



#---#

#echo -e "${YELLOW}\n-----------################-------------\n${COLOR_OFF}" 

#while read name
#do
#find "$MOVIE_SYM"/ -maxdepth 2 -type d -iname "*$name*" | sort -bf >> "$TMP3"
#done < "$BATCH_FILE_MOVIE_FIND"

#WHITE 
#sort -bf "$TMP3" 

#echo -e "${YELLOW}\n-----------################-------------\n${COLOR_OFF}"



#echo "Log File:   sudo geany $TMP_LOG1"

else
sudo nano $BATCH_FILE_MOVIE_FIND ; c.ln2tb-movie-find-batch

fi

exit 0

;;
1)
sudo nano $BATCH_FILE_MOVIE_FIND ; c.ln2tb-movie-find-batch
;;
2)
_CANCEL_MSG ;; 
esac
