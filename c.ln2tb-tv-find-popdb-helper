#!/bin/bash
# Populate my DB of TVs
SCRIPT_NAME="c.ln2tb-tv-find-popdb-helper"

# Source the VAR MOAS
source /usr/local/bin/VAR-SCRIPT


count="$(cat $count_file)"


DIR="$(echo $( dirname "$( echo $1 )") | rev |cut -d/ -f1 |rev)"
NAME="$(basename "$( echo $1 )")"
SUB="$( echo $1 | rev |cut -b 5- | rev )"

SUBTITILE="NO"
if find "$SUB"*.srt -exec echo -e "$YELLOW Found Subtitle: $COLOR_OFF" {} \; 2>/dev/null ; then SUBTITILE="YES" ; fi
if find "$SUB"*.sub -exec echo -e "$YELLOW Found Subtitle: $COLOR_OFF" {} \; 2>/dev/null ; then SUBTITILE="YES" ; fi


mysql -uroot -p"$DB_PASSWORD" tv << EOF
INSERT INTO tv (Name,Size_MB,ResWidth,ResHeight,Watched,Notes,Definition,Date,Subtitle) 
VALUES ("$DIR/$NAME", "-", "-", "-", "-", "-", "-", "-", "$SUBTITILE")
ON DUPLICATE KEY UPDATE 
	Name = "$DIR/$NAME",
	Subtitle = "$SUBTITILE";	
EOF

GREEN
echo -e "$count)${CYAN} Adding Episode: ${COLOR_OFF}$DIR/$NAME"
echo $((count + 1)) > "$count_file"
